{
    "nftables": [
        {
            "table": {
                "family": "ip",
                "name": "firewall",
                "handle": 20
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "firewall",
                "name": "forward",
                "handle": 1,
                "type": "filter",
                "hook": "forward",
                "prio": 1,
                "policy": "drop"
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 36,
                "comment": "accept established connections",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": [
                                "established",
                                "related"
                            ]
                        }
                    },
                    {
                        "counter": {
                            "packets": 23771191,
                            "bytes": 12722566333
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 37,
                "comment": "drop packets with invalid ct state",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "invalid"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 38,
                "comment": "drop ping floods",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "icmp",
                                    "field": "type"
                                }
                            },
                            "right": "echo-request"
                        }
                    },
                    {
                        "limit": {
                            "rate": 10,
                            "per": "second",
                            "inv": true,
                            "burst": 4
                        }
                    },
                    {
                        "counter": {
                            "packets": 1,
                            "bytes": 28
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 39,
                "comment": "accept icmp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "icmp",
                                    "field": "type"
                                }
                            },
                            "right": {
                                "set": [
                                    "destination-unreachable",
                                    "router-advertisement",
                                    "router-solicitation",
                                    "time-exceeded",
                                    "parameter-problem"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 40,
                "comment": "accept traffic for k8s service kube-system/vpn-shoot",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    "212.34.89.17"
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    4314
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 2,
                            "bytes": 120
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 41,
                "comment": "accept traffic for k8s service kube-system/addons-nginx-ingress-controller",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    "212.34.89.18"
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "http",
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 9744,
                            "bytes": 507012
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 42,
                "comment": "accept traffic for k8s service shoot--pbcf4p--sap-seed02/kube-apiserver",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    "212.34.89.19"
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 4411,
                            "bytes": 266043
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 43,
                "comment": "accept traffic for np egress-allow-vpn tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    4314
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 4,
                            "bytes": 240
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 44,
                "comment": "accept traffic for np egress-allow-https tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 5536,
                            "bytes": 335062
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 45,
                "comment": "accept traffic for np egress-allow-dns tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "domain"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 1,
                            "bytes": 40
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 46,
                "comment": "accept traffic for np egress-allow-http tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "http"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 47,
                            "bytes": 2084
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 47,
                "comment": "accept traffic for np egress-allow-ntp udp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "ntp"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 156,
                            "bytes": 11649
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 48,
                "comment": "accept traffic for np egress-allow-vpn udp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    4314
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 49,
                "comment": "accept traffic for np egress-allow-dns udp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "set": [
                                    {
                                        "range": [
                                            "0.0.0.0",
                                            "255.255.255.255"
                                        ]
                                    }
                                ]
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "domain"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 8529,
                            "bytes": 776291
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 50,
                "comment": "accept traffic for np allow-kube-apiserver tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    2379
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 2,
                            "bytes": 80
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 51,
                "comment": "accept traffic for np allow-to-shoot-apiserver tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 52,
                "comment": "accept traffic for np gardener-extension-provider-metal tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 53,
                "comment": "accept traffic for np kubeapi2kube-jwt-authn-webhook tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 54,
                "comment": "accept traffic for np kubeapi2limit-validating-webhook tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "https"
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 55,
                "comment": "accept traffic for np allow-to-dns tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "domain",
                                    8053
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 56,
                "comment": "accept traffic for np gardener.cloud--allow-to-dns tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "domain",
                                    8053
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 57,
                "comment": "accept traffic for np allow-grafana tcp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    9090
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 28,
                            "bytes": 1304
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 58,
                "comment": "accept traffic for np allow-to-dns udp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "domain",
                                    8053
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 59,
                "comment": "accept traffic for np gardener.cloud--allow-to-dns udp",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": {
                                "set": [
                                    "domain",
                                    8053
                                ]
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 60,
                "comment": "count dropped packets",
                "expr": [
                    {
                        "counter": {
                            "packets": 14173,
                            "bytes": 701874
                        }
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "firewall",
                "chain": "forward",
                "handle": 61,
                "expr": [
                    {
                        "limit": {
                            "rate": 10,
                            "per": "second",
                            "burst": 5
                        }
                    },
                    {
                        "counter": {
                            "packets": 14169,
                            "bytes": 696894
                        }
                    },
                    {
                        "log": {
                            "prefix": "nftables-firewall-dropped: "
                        }
                    }
                ]
            }
        },
        {
            "table": {
                "family": "ip",
                "name": "metal",
                "handle": 21
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "metal",
                "name": "input",
                "handle": 1,
                "type": "filter",
                "hook": "input",
                "prio": 0,
                "policy": "drop"
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 5,
                "comment": "stateful input",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": [
                                "established",
                                "related"
                            ]
                        }
                    },
                    {
                        "counter": {
                            "packets": 136516,
                            "bytes": 183088634
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 6,
                "comment": "BGP unnumbered",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "iifname"
                            },
                            "right": "lo"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 7,
                "comment": "incoming VXLAN lan0",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "iifname"
                            },
                            "right": "lan0"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "10.0.0.0",
                                    "len": 8
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": 4789
                        }
                    },
                    {
                        "counter": {
                            "packets": 8963363,
                            "bytes": 4429673897
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 8,
                "comment": "incoming VXLAN lan1",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "iifname"
                            },
                            "right": "lan1"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "10.0.0.0",
                                    "len": 8
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": 4789
                        }
                    },
                    {
                        "counter": {
                            "packets": 15003638,
                            "bytes": 9678054737
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 9,
                "comment": "SSH incoming connections",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": "ssh"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "new"
                        }
                    },
                    {
                        "counter": {
                            "packets": 2125,
                            "bytes": 89448
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 10,
                "comment": "node metrics",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "10.0.0.0",
                                    "len": 8
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": 9100
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 11,
                "comment": "nftables metrics",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "10.0.0.0",
                                    "len": 8
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": 9630
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 12,
                "comment": "drop invalid packets to prevent malicious activity",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "invalid"
                        }
                    },
                    {
                        "counter": {
                            "packets": 70,
                            "bytes": 11004
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "input",
                "handle": 13,
                "expr": [
                    {
                        "counter": {
                            "packets": 4352,
                            "bytes": 221616
                        }
                    },
                    {
                        "jump": "refuse"
                    }
                ]
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "metal",
                "name": "forward",
                "handle": 2,
                "type": "filter",
                "hook": "forward",
                "prio": 0,
                "policy": "accept"
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "forward",
                "handle": 14,
                "comment": "drop invalid packets from forwarding to prevent malicious activity",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "invalid"
                        }
                    },
                    {
                        "counter": {
                            "packets": 128,
                            "bytes": 15456
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "forward",
                "handle": 15,
                "comment": "block bgp forward to machines",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": "bgp"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "new"
                        }
                    },
                    {
                        "counter": {
                            "packets": 2,
                            "bytes": 80
                        }
                    },
                    {
                        "jump": "refuse"
                    }
                ]
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "metal",
                "name": "output",
                "handle": 3,
                "type": "filter",
                "hook": "output",
                "prio": 0,
                "policy": "accept"
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "output",
                "handle": 16,
                "comment": "lo output required e.g. for chrony",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "oifname"
                            },
                            "right": "lo"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "output",
                "handle": 17,
                "comment": "stateful output",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": [
                                "established",
                                "related"
                            ]
                        }
                    },
                    {
                        "counter": {
                            "packets": 341414,
                            "bytes": 32986280
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "output",
                "handle": 18,
                "comment": "outgoing VXLAN",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "daddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "10.0.0.0",
                                    "len": 8
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "udp",
                                    "field": "dport"
                                }
                            },
                            "right": 4789
                        }
                    },
                    {
                        "counter": {
                            "packets": 24063180,
                            "bytes": 13948946223
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "output",
                "handle": 19,
                "comment": "drop invalid packets",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "invalid"
                        }
                    },
                    {
                        "counter": {
                            "packets": 10,
                            "bytes": 720
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "metal",
                "name": "refuse",
                "handle": 4
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "refuse",
                "handle": 20,
                "expr": [
                    {
                        "limit": {
                            "rate": 2,
                            "per": "minute",
                            "burst": 5
                        }
                    },
                    {
                        "counter": {
                            "packets": 971,
                            "bytes": 48172
                        }
                    },
                    {
                        "log": {
                            "prefix": "nftables-metal-dropped: "
                        }
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "metal",
                "chain": "refuse",
                "handle": 21,
                "expr": [
                    {
                        "counter": {
                            "packets": 4354,
                            "bytes": 221696
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "table": {
                "family": "ip",
                "name": "nat",
                "handle": 22
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "nat",
                "name": "prerouting",
                "handle": 1,
                "type": "nat",
                "hook": "prerouting",
                "prio": 0,
                "policy": "accept"
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "nat",
                "name": "input",
                "handle": 2,
                "type": "nat",
                "hook": "input",
                "prio": 0,
                "policy": "accept"
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "nat",
                "name": "output",
                "handle": 3,
                "type": "nat",
                "hook": "output",
                "prio": 0,
                "policy": "accept"
            }
        },
        {
            "chain": {
                "family": "ip",
                "table": "nat",
                "name": "postrouting",
                "handle": 4,
                "type": "nat",
                "hook": "postrouting",
                "prio": 0,
                "policy": "accept"
            }
        },
        {
            "rule": {
                "family": "ip",
                "table": "nat",
                "chain": "postrouting",
                "handle": 5,
                "comment": "snat (networkid: internet-nbg-w8101)",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "oifname"
                            },
                            "right": "vlan104009"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "10.3.72.0",
                                    "len": 22
                                }
                            }
                        }
                    },
                    {
                        "counter": {
                            "packets": 13268,
                            "bytes": 1035633
                        }
                    },
                    {
                        "masquerade": null
                    }
                ]
            }
        },
        {
            "table": {
                "family": "ip6",
                "name": "metal",
                "handle": 23
            }
        },
        {
            "chain": {
                "family": "ip6",
                "table": "metal",
                "name": "input",
                "handle": 1,
                "type": "filter",
                "hook": "input",
                "prio": 0,
                "policy": "drop"
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 5,
                "comment": "icmpv6 input required for neighbor discovery",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "l4proto"
                            },
                            "right": "ipv6-icmp"
                        }
                    },
                    {
                        "counter": {
                            "packets": 9875,
                            "bytes": 633712
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 6,
                "comment": "BGP unnumbered",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "iifname"
                            },
                            "right": "lo"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 7,
                "comment": "stateful input",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": [
                                "established",
                                "related"
                            ]
                        }
                    },
                    {
                        "counter": {
                            "packets": 113640,
                            "bytes": 9285080
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 8,
                "comment": "bgp unnumbered input from lan0",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "iifname"
                            },
                            "right": "lan0"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip6",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "fe80::",
                                    "len": 64
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": "bgp"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 9,
                "comment": "bgp unnumbered input from lan1",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "iifname"
                            },
                            "right": "lan1"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip6",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "fe80::",
                                    "len": 64
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": "bgp"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 10,
                "comment": "drop invalid packets to prevent malicious activity",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "invalid"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "input",
                "handle": 11,
                "expr": [
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "jump": "refuse"
                    }
                ]
            }
        },
        {
            "chain": {
                "family": "ip6",
                "table": "metal",
                "name": "forward",
                "handle": 2,
                "type": "filter",
                "hook": "forward",
                "prio": 0,
                "policy": "drop"
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "forward",
                "handle": 12,
                "comment": "drop invalid packets from forwarding to prevent malicious activity",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": "invalid"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "forward",
                "handle": 13,
                "expr": [
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "jump": "refuse"
                    }
                ]
            }
        },
        {
            "chain": {
                "family": "ip6",
                "table": "metal",
                "name": "output",
                "handle": 3,
                "type": "filter",
                "hook": "output",
                "prio": 0,
                "policy": "drop"
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "output",
                "handle": 14,
                "comment": "stateful output",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "ct": {
                                    "key": "state"
                                }
                            },
                            "right": [
                                "established",
                                "related"
                            ]
                        }
                    },
                    {
                        "counter": {
                            "packets": 113073,
                            "bytes": 9244176
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "output",
                "handle": 15,
                "comment": "BGP unnumbered",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "oifname"
                            },
                            "right": "lo"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "output",
                "handle": 16,
                "comment": "icmpv6 output required for neighbor discovery",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "l4proto"
                            },
                            "right": "ipv6-icmp"
                        }
                    },
                    {
                        "counter": {
                            "packets": 9876,
                            "bytes": 633776
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "output",
                "handle": 17,
                "comment": "bgp unnumbered output at lan0",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "oifname"
                            },
                            "right": "lan0"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip6",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "fe80::",
                                    "len": 64
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": "bgp"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "output",
                "handle": 18,
                "comment": "bgp unnumbered output at lan1",
                "expr": [
                    {
                        "match": {
                            "left": {
                                "meta": "oifname"
                            },
                            "right": "lan1"
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "ip6",
                                    "field": "saddr"
                                }
                            },
                            "right": {
                                "prefix": {
                                    "addr": "fe80::",
                                    "len": 64
                                }
                            }
                        }
                    },
                    {
                        "match": {
                            "left": {
                                "payload": {
                                    "name": "tcp",
                                    "field": "dport"
                                }
                            },
                            "right": "bgp"
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "accept": null
                    }
                ]
            }
        },
        {
            "chain": {
                "family": "ip6",
                "table": "metal",
                "name": "refuse",
                "handle": 4
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "refuse",
                "handle": 19,
                "expr": [
                    {
                        "limit": {
                            "rate": 2,
                            "per": "minute",
                            "burst": 5
                        }
                    },
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "log": {
                            "prefix": "nftables-metal-dropped: "
                        }
                    }
                ]
            }
        },
        {
            "rule": {
                "family": "ip6",
                "table": "metal",
                "chain": "refuse",
                "handle": 20,
                "expr": [
                    {
                        "counter": {
                            "packets": 0,
                            "bytes": 0
                        }
                    },
                    {
                        "drop": null
                    }
                ]
            }
        }
    ]
}